# Development of credativ-pg-migrator

Repository contains python solution for migration of the whole database from legacy systems to PostgreSQL.
Testing OMDB example is in the ./tests/omdb directory - see README.md in that directory for more information.

## Main features

- Pure python solution, uses only staandard libraries, structured in modules, written in object-oriented style
- Supports migration of tables, column constraints, primary keys, indexes, foreign keys from source to target database
- Post migrattion setting of current values of sequences on the target database
- Rudimentary migration of views
- Conversion and migration of functions, procedures, triggers
- Customizable substitutions of data types and default values of columns
- Migrator provides reach logging and error handling, has 2 levels of logging - INFO and DEBUG, in case of error, detailed error message is printed
- By default logging messages are printed both to console and to log file, name of the log file is configurable in command line arguments

## Source databases

- Source database connector must implement DatabaseConnector class from the migrator.database_connector module
- Methods of this class contain descriptions of actions and return values that are expected by the migrator tool
- Solution currently supports these source databases:
  - Sybase ASE
  - Informix
- both databases can be accessed either via ODBC or JDBC

## Target databases

- Target database connector must implement DatabaseConnector class from the migrator.database_connector module
- Solution currently supports only PostgreSQL as target database

## Migration database

- Solution uses a migration database to store metadata about the migration process
- Migration database is a PostgreSQL database, credentials must be configured in the configuration file
- In most cases we assume that the migration database will the same as the target database, but it is possible to use a different database from the same or different PostgreSQL server

## Configuration file

- Configuration file is a YAML file
- Settings available in the config file are described in the documentation

## Todo

- In Informix we currently do not support ROW data type (corresponds with PostgreSQL composite type)
- We currently do not support automatic migration of cross-database references - see in notes to TODO
- Not all types of default values are currently supported
- Not all constrains are covered
- In bot cases (defaults/constrints), we add them into tool case by case, as we encounter them, each legacy system uses its own internal format, but documentation does not contain examples of internal representation of all possible cases
- Add support for PostgreSQL as source database

### Notes to TODO

- Many legacy systems allowed cross-database queries, which is not supported in PostgreSQL and requires usage of foreign data wrappers
- Functions / procedures and views that use cross-database queries must be manually adjusted

## Structure of the repository

The repository is structured as follows:

- config - Contains different configuration files for the migrator tool
- lib - Contains different libraries used by the migrator tool - java jdbc drivers, C++ client libraries, etc.
- logs - Contains log files generated by the migrator tool
- migrator - Contains the main codebase for the migrator tool
- migrator_venv - Contains the virtual environment for the migrator tool - not included in the repository, must be created locally using script ./setup_env.sh
- poc - Contains multiple isolated scripts for testing different functionalities of the migrator tool during development
- scripts - Contains different bash scripts for the migrator tool
- sql - Contains SQL scripts for creating tables and inserting data into the source database
- tests - Contains test cases for the migrator tool
