# Development of credativ-pg-migrator

- Repository contains python solution for migration of the whole database from legacy systems to PostgreSQL.
- Testing examples are in the [tests directory](./tests/) - see [README](./tests/README.md) for more information and READMEs in each subdirectory.
- See fixes and updates in [CHANGELOG.md](./CHANGELOG.md).
- See feature matrix in [FEATURE_MATRIX.md](./FEATURE_MATRIX.md) for supported features in different database connectors.

## Architecture

![Architecture](./docs/images/architecture.jpg)

## Main features

- Pure python solution, uses only standard libraries, structured in modules, written in object-oriented style in classes
- Supports migration of tables, column constraints and defaults, data, primary keys, secondary indexes, foreign keys, functions/procedures, triggers and views from source to target database
- If tables have sequences, migrator sets current values of sequences on the target database
- Migration of views is currently only in rudimentary version, just replacing source schema names in code with target schema names
- Conversion and migration of functions, procedures, triggers currently fully works for Informix. Can be added on demand for other databases too.
- Migrator allows customizable substitutions of data types, default values of columns, calls of remote objects.
- User can also define limitations for migration of data - as where conditions for tables. This option requires good analysis of dependencies in the source database. Missing data can break Foreign Key constraints in the target database. See further in the documentation.
- Migrator provides reach logging and error handling, has 2 levels of logging - INFO and DEBUG, in case of error, detailed error message is printed.
- By default logging messages are printed both to console and to log file, name of the log file is configurable in command line arguments.
- Rich information is also logged to the migration database - see below.

## Source databases

- Currently supported source databases are:
  - IBM dDB2 LUW
  - Informix
  - MS SQL Server
  - MySQL/MariaDB (engines with INFORMATION_SCHEMA)
  - Oracle
  - PostgreSQL (mainly for special use cases)
  - SQL Anywhere
  - Sybase ASE
- Source database connector must implement DatabaseConnector class from the [migrator.database_connector](./migrator/database_connector.py) module
- Methods of this class contain descriptions of actions and return values that are expected by the migrator tool
- Supported databases should be accessed via ODBC, JDBC or native python libraries. Not all options are available for all databases.

## Target databases

- Target database connector must implement DatabaseConnector class from the migrator.database_connector module
- Solution currently supports only PostgreSQL as target database

## Migration database

- Solution uses a migration database to store metadata about the migration process
- Migration database is a PostgreSQL database, credentials must be configured in the configuration file
- In most cases we assume that the migration database will the same as the target database, but it is fully possible to use a different database from the same or different PostgreSQL server
- Migration protocol tables contain detailed information about all migrated objects, like source code, target code, success or failure of migration, etc.

## Configuration file

- Configuration file is a YAML file
- Settings available in the config file are described in [config_sample.yaml](./config_sample.yaml) file

## TODO

- In Informix we currently do not support ROW data type (corresponds with PostgreSQL composite type)
- Not all types of default values are currently supported simply because we do not know all possible values/functions. Every database is somehow unique, so these will be added on demand.
- Support for partitioning of target tables is only in the experimental stage.

## Structure of the repository

The repository is structured as follows:

- config - different configuration files for the migrator tool
- lib - different libraries used by the migrator tool - java jdbc drivers, C++ client libraries, etc.
- logs - log files generated by the migrator tool
- migrator - the main codebase for the migrator tool
- migrator_venv - the virtual environment for the migrator tool - not included in the repository, must be created locally using script ./setup_env.sh
- poc - multiple isolated scripts for testing different functionalities of the migrator tool during development
- scripts - different bash scripts for the migrator tool
- sql - SQL scripts different purposes like for creating tables and inserting data into the source database
- tests - test cases for the migrator tool for different source databases
