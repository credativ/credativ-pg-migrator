# Development of credativ-pg-migrator

Repository contains python solution for migration of the whole database from legacy systems to PostgreSQL.
Testing PostgreSQL->PostgreSQL OMDB example is in the ./tests/omdb directory - see README.md in that directory for more information.

## Architecture

![Architecture](./docs/images/architecture.jpg)

## Main features

- Pure python solution, uses only standard libraries, structured in modules, written in object-oriented style in classes
- Supports migration of tables, column constraints and defaults, primary keys, secondary indexes, foreign keys, functions/procedures, triggers and views from source to target database
- If tables have sequences, migrator sets current values of sequences on the target database
- Migration of views is currently only in rudimentary version, just replacing source schema names in code with target schema names
- Conversion and migration of functions, procedures, triggers currently fully works for Informix, and is in progress for Sybase
- Migrator allows customizable substitutions of data types, default values of columns, calls of remote objects
- Migrator provides reach logging and error handling, has 2 levels of logging - INFO and DEBUG, in case of error, detailed error message is printed
- By default logging messages are printed both to console and to log file, name of the log file is configurable in command line arguments
- Rich information is also logged to the migration database - see below

## Source databases

- Currently supported source databases are Informix, Sybase ASE, PostgreSQL
- Basic support for MS SQL Server is in progress
- Source database connector must implement DatabaseConnector class from the migrator.database_connector module
- Methods of this class contain descriptions of actions and return values that are expected by the migrator tool
- Support database should be accessed via ODBC, JDBC or native client libraries

## Target databases

- Target database connector must implement DatabaseConnector class from the migrator.database_connector module
- Solution currently supports only PostgreSQL as target database

## Migration database

- Solution uses a migration database to store metadata about the migration process
- Migration database is a PostgreSQL database, credentials must be configured in the configuration file
- In most cases we assume that the migration database will the same as the target database, but it is fully possible to use a different database from the same or different PostgreSQL server

## Configuration file

- Configuration file is a YAML file
- Settings available in the config file are described in the documentation

## Todo

- In Informix we currently do not support ROW data type (corresponds with PostgreSQL composite type)
- Automatic replacement of cross-database references is in progress
- Not all types of default values are currently supported

## Structure of the repository

The repository is structured as follows:

- config - Contains different configuration files for the migrator tool
- lib - Contains different libraries used by the migrator tool - java jdbc drivers, C++ client libraries, etc.
- logs - Contains log files generated by the migrator tool
- migrator - Contains the main codebase for the migrator tool
- migrator_venv - Contains the virtual environment for the migrator tool - not included in the repository, must be created locally using script ./setup_env.sh
- poc - Contains multiple isolated scripts for testing different functionalities of the migrator tool during development
- scripts - Contains different bash scripts for the migrator tool
- sql - Contains SQL scripts for creating tables and inserting data into the source database
- tests - Contains test cases for the migrator tool
